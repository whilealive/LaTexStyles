% ==================================================================
% FILE     basicMacrosLT.sty
% MACHINE  all
% INFO     Macro collection (LuaLaTeX)
%
% DATE     30.06.2017
% OWNER    Bischofberger
% ==================================================================

\ProvidesPackage{basicMacrosLT}


% ----------------------------------------------------------------
% local helper makros
% ----------------------------------------------------------------
% http://tex.stackexchange.com/questions/204699/smaller-vertical-space-between-repeated-environments
\def\@NoBlankPenalty{12345}  % do not add vertical space at \MySkippingPenalty
\newcommand*{\DoNotAddBlank}{\penalty\@NoBlankPenalty}
\newcommand*{\SpaceAbove}{\ifnum\lastpenalty=\@NoBlankPenalty\vskip-\baselineskip\penalty0\fi}
\newlength{\AfterSkip}
\setlength{\AfterSkip}{\baselineskip}
\newcommand*{\SpaceBelow}{\par\addvspace{\AfterSkip}\DoNotAddBlank}


% ----------------------------------------------------------------
% custom commands and environments...
% ----------------------------------------------------------------
\newcommand*{\BZ}[1][1]{\vskip #1\baselineskip}  % 1 Blindzeile

% fill page from bottom to top
\newenvironment{bottompar}{\par\vspace*{\fill}}{\clearpage}

% Struts for added vertical spacing in tabular environments
% Insert struts directly in nominator/denominator/sub-/superscripts of fractions/sums etc.!
\newcommand*\TStrut{\rule{0pt}{2.6ex}}       % Top strut
\newcommand*\BStrut{\rule[-1.2ex]{0pt}{0pt}} % Bottom strut

% unit conversion: \convertto{mm}{25}
% % pt, mm, cm, ex, em, bp, dd, pc, in
\def\convertto#1#2{\strip@pt\dimexpr #2*65536/\number\dimexpr 1#1\relax#1}

% tables
\RequirePackage{booktabs}
\RequirePackage{tabularx}                                  % loads array package
\newcolumntype{P}[1]{>{\raggedright\arraybackslash}p{#1}}  % tabular: fixed width left-justified column
\newcolumntype{C}[1]{>{\centering\arraybackslash}p{#1}}    % tabular: fixed width centered column
\newcolumntype{L}{>{\raggedright\arraybackslash}X}         % tabularx: left-justified column type for tabularx
\newcolumntype{Z}{>{\centering\arraybackslash}X}           % tabularx: centered column type for tabularx

% lists
\RequirePackage[inline]{enumitem}
\newlist{myenum}{enumerate}{2}
\newlist{myitem}{itemize}{2}
\newlist{alphenum}{enumerate}{2}
\setlist[myenum,1,2]{label=\arabic*.,leftmargin=*,nosep,align=left}
\setlist[myitem,1,2]{label=--,leftmargin=*,nosep,align=left}
\setlist[alphenum,1,2]{label=\alph*),leftmargin=*,nosep,align=left,widest=a}  % manually set "widest=m" if list is long

% ----------
% tabbedenum: horizontal alphanumeric lists (for exercises)
%
% keys
\ExplSyntaxOn
\keys_define:nn{basicMacros/tabbedenum}
{%
  space above  .tl_set:N = \l__basicMacros_SpaceAbove_tl,
  space below  .tl_set:N = \l__basicMacros_SpaceBelow_tl,
  line spacing .tl_set:N = \l__basicMacros_LineSpacing_tl,
  label        .tl_set:N = \l__basicMacros_Label_tl,
  space above  .value_required:n = true,
  space below  .value_required:n = true,
  line spacing .value_required:n = true,
  label        .value_required:n = true,
  space above  .initial:n = 0ex,
  space below  .initial:n = 0ex,
  line spacing .initial:n = 1.2,
  label        .initial:n = \alph*),
}

% \begin{tabbedenum}[space above=0ex,space below=0ex]{2} ...
% args: #1 (optional): space above/below, #2: \item...
% http://tex.stackexchange.com/questions/34971/how-to-keep-a-constant-baselineskip-when-using-minipages-or-parboxes
%
\RequirePackage{tabto}
\NewDocumentEnvironment{tabbedenum}{ o m }
{%
  \group_begin:
    \IfNoValueF{#1}{\keys_set:nn{basicMacros/tabbedenum}{#1}}
    \par\vskip \l__basicMacros_SpaceAbove_tl
    \NumTabs{#2}
    \begin{minipage}[t]{\textwidth}
      \linespread{\l__basicMacros_LineSpacing_tl}\selectfont
      \begin{enumerate*}[label=\l__basicMacros_Label_tl,itemjoin={\tab}]%
}{%
      \end{enumerate*}%
      \par\xdef\tpd{\the\prevdepth}
    \end{minipage}
    \par\prevdepth\tpd
    \par\vspace{\l__basicMacros_SpaceBelow_tl}
  \group_end:
}
\ExplSyntaxOff
%
% ----------

% double underline for end results
\newcommand{\Result}[1]{\underline{\underline{#1\rule[-0.6ex]{0pt}{0pt}}}}
\newcommand*\bigfrac{\genfrac{}{}{1pt}{0}}   % nested fractions

% absolute value
\DeclarePairedDelimiter\abs{\lvert}{\rvert}

% sets and constants
\newcommand*{\N}{\ensuremath{\mathbb{N}}}
\newcommand*{\Z}{\ensuremath{\mathbb{Z}}}
\newcommand*{\Q}{\ensuremath{\mathbb{Q}}}
\newcommand*{\R}{\ensuremath{\mathbb{R}}}
\newcommand*{\C}{\ensuremath{\mathbb{C}}}
\newcommand*{\Euler}{\ensuremath{\mathrm{e}}}
\newcommand*{\Complex}{\ensuremath{i}}
\newcommand*{\D}[1]{\ensuremath{\mathrm{d}#1}}  % dx, dy...
\DeclareMathOperator{\GGT}{ggT}
\DeclareMathOperator{\KGV}{kgV}
\DeclareMathOperator{\Mean}{E}  % mean (stochastics)
\DeclareMathOperator{\Var}{Var} % variance (stochastics)

% sets (logic)
\newcommand*{\Logic}[1]{\textsf{\textbf{#1}}}

% radiant angle: frown above (coult be improved...)
\newcommand*\Radiant[2][\textstyle]{\ensuremath{%
  \kern-.7em\array[b]{c}\text{\scalebox{1.6}{$#1\frown$}}\\[-1.8ex]#1#2\endarray}\kern-0.8em}

% Theorems
\newenvironment{Bsp}{\SpaceAbove\BZ\noindent\textbf{Beispiel\enspace}}{\SpaceBelow}
\newenvironment{Def}{\SpaceAbove\BZ\noindent\textbf{Definition\enspace}}{\SpaceBelow}
\newenvironment{Bem}{\SpaceAbove\BZ\noindent\textbf{Bemerkung\enspace}}{\SpaceBelow}
\newenvironment{Zus}{\SpaceAbove\BZ\noindent\textbf{Zusammenfassung\enspace}}{\SpaceBelow}
\newenvironment{Sol}{\SpaceAbove\BZ\noindent\textit{LÃ¶sung\enspace}}{\SpaceBelow}

% definition frame
\RequirePackage[xcolor]{mdframed}
\NewDocumentEnvironment{FrameDef}{}
{%
  \begin{mdframed}[nobreak,linecolor=gray!40!,linewidth=2pt,innertopmargin=1pt,innerbottommargin=0pt]
    \begin{Def}
}{%
    \end{Def}
  \end{mdframed}
  \DoNotAddBlank
}


% ----------------------------------------------------------------
% all about Exercises...
% ----------------------------------------------------------------
\newcounter{excounter}
\renewcommand*{\theexcounter}{\arabic{excounter}}

\newenvironment{AufgLsg}[1]{% adds label for solution -> see LsgAufg
  \refstepcounter{excounter}%
  \SpaceAbove%
  \label{#1}%
  \BZ\noindent\textbf{Aufgabe~\theexcounter{\boldmath$^{L}$}\enspace}%
}{\SpaceBelow}

\newenvironment{Aufg}[1][\theexcounter]{% normal
  \ifx\theexcounter#1\refstepcounter{excounter}\fi%
  \SpaceAbove%
  \BZ\noindent\textbf{Aufgabe~#1\enspace}%
}{\SpaceBelow}

\newenvironment{Aufg*}[1][\theexcounter]{% difficult
  \ifx\theexcounter#1\refstepcounter{excounter}\fi%
  \SpaceAbove%
  \BZ\noindent\textbf{Aufgabe~#1*\enspace}%
}{\SpaceBelow}

% solution of a single exercise
\newenvironment{LsgAufg}[1]{%
  \textbf{Aufg. \ref{#1} }%
}{\par\addvspace{.5\baselineskip}}

